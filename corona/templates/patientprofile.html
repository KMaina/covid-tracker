{% extends 'base.html' %}
  <!-- Page styling-->
  {% load bootstrap4 %}
  {% include 'material/includes/material_css.html' %}
  {% include 'material/includes/material_js.html' %}
  
  <!-- Page script-->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  {% block content %}
  {{block.super}}
    <!-- Add navigation Bar-->
    {% include "navbar.html" %}
      <!--Main row -->
      <div class="row">          

        <div class="col-md-2"><!--Empty column to center the profile--> </div>      
          <div class="col-md-8" style="background: #b1e8fb77;"> 
              
            <!-- Profile Picture-->
            <div class="container" style="margin-top: 30px; text-align: center;">                
                <img src="{{ profile.photo_url|default_if_none:'https://icon-library.net/images/patient-icon/patient-icon-25.jpg' }}" alt="profile picture" style=" width:225px; height: 225px; border-radius:50%;">                                
                {% if current_user.is_doctor %}                
                {% else%}
                  <a href="{% url 'editprofile'%}"><button style="display: inline-block;" class="btn btn-primary">Update Profile</button></a>                  
                {% endif %}
            </div>
            
            <!-- Name and email of profile -->
            <div class="container" style="margin-left: 12%; margin-top: 30px;">
                <h6 style="display: inline-block; padding-right: 15%;">Name: <span style="font-size: 20px;">{{profile.name}}</span></h6>
                <h6 style="display: inline-block;">Email: <span style="font-size: 20px;">{{profile.user.email}}</span></h6>
            </div>
                            
            <!-- Profile details i.e Phone,location, their status, prefered treatment-->
            <h6 style="display: inline-block;margin-left: 15%; padding-right:15%;">Phone no.: <span style="font-size: 20px;">{{profile.phone}}</span></h6>
            <h6 style="display: inline-block;">Status: <span style="font-size: 20px;">{{patient_report.status}}</span></h6>            
            <h6 style="display: inline-block;margin-left: 15%; padding-right:15%;">Location: <span style="font-size: 20px;">{{profile.location}}</span></h6>
            <h6 style="display: inline-block;">Treatment: <span style="font-size: 20px;">{{patient_report.treatment}}</span></h6>            
              
              
              <div class="row" style="margin-top: 30px;">

                <!-- Patient live location cordinates on a map -->
                <div class="col">
                    User location map
                </div>

                <!-- Doctors report section-->
                <div class="col">
                  <div class="container" style="background:white;">

                    <!-- The section heading and if condition to allow only doctors to access the input button -->
                    <div class="container" style="padding: 10px;">
                      <h5 style="text-align: center; color: blue; display: inline-block; padding-right: 30%;">Doctor's report</h5>  
                      {% if current_user.is_doctor %}
                        <button class="btn btn-primary" style="display: inline-block;" data-toggle="modal" data-target="#reportform" >Add Report</button>                      
                      {% else %}
                      {% endif %}
                    </div>  
                    
                    <!-- Report table-->              
                    <table class="table table-hover">                                                    
                          <tbody>                                                    
                            <tr>                                
                              <td colspan="3" style="font-weight: bold;">Temperature</td>                                
                              {% if patient_report.temp %}
                              <td> {{patient_report.temp}} °C</td>
                              {% else %}
                              <td>--°C</td>                            
                              {% endif %}
                            </tr>
                            <tr>
                              <td colspan="3" style="font-weight: bold;">Test No.</td>                                                                
                              {% if patient_report.kit %}
                              <td> {{patient_report.kit}}</td>
                              {% else %}
                              <td>----</td>                            
                              {% endif %}
                            </tr>         
                            <tr>
                              <td style="font-weight: bold;">Comment</td>                                
                              {% if patient_report.comments %}
                                <td colspan="4">
                                  {{patient_report.comments | safe}}
                                  <p style="font-size: 12px; color: grey; margin-left: 60%;">Dr. {{patient_report.doctor}}</p>
                                </td>
                              {% else %}
                                <td colspan="4"> No comments yet.</td>
                              {% endif %}
                            </tr>                                               
                          </tbody>                                                                        
                    </table>
                    
                  </div>
                </div>

                <!-- Edit Health Report Modal -->
                <div class="modal fade" id="reportform" tabindex="-1" role="dialog" aria-labelledby="reportform" aria-hidden="true" >
                  <div class="modal-dialog modal-lg modal-dialog-centered" role="document"  style="background:url('https://images.unsplash.com/photo-1581299327801-faeb40ea459e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1171&q=80')">
                    <div class="modal-content" style="background:white;" >
                      <div class="modal-header">
                        <h4 class="modal-title" style="margin-left: 40%;">Doctor's Report</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div> 
                      <div class="modal-body">
                        <div class="container" style="text-align: center; width:80%;">
                          <form action="{% url 'visitprofile' profile.user.id %}" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                        
                            {% bootstrap_form reportform %}
                            <input type="submit" class="btn btn-success btn-lg" value="Update report">
                          </form> 
                        </div>
                      </div>    
                    </div>
                  </div>
                </div>

              </div> 

              <!-- Contact tracing section -->
              <div class="container" style="background: white; margin-top:15vh;">
                <div class="container">
                  <div class="row">  
                    
                    <!-- Contact tracing table -->
                    <table class="table">
                      <thead class="thead-dark">
                        <tr>                            
                          <th scope="col">Name</th>
                          <th scope="col">Email</th>
                          <th scope="col">Phone</th>
                          <th scope="col">Location</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for cont in contacts %}
                        <tr>                            
                          <td>{{cont.name}}</td>
                          <td>{{cont.email}}</td>
                          <td>{{cont.phone}}</td>
                          <td>{{cont.location}}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>   

                  </div>

                  <!-- Contact tracing form -->
                  <div class="row">
                    {% if current_user.is_doctor %}
                      <!-- If you're a doctor you get nothing-->
                    {% else %}
                      <!-- Patient get's a form to fill their contacts-->
                      <div class="col-md-6 col-md-offset-3">
                        
                      </div>

                    {% endif %}
                  </div>
                </div>
              </div>            
          </div>
        <div class="col"><!-- Empty col to center the profile--></div>
      </div>    
  {% bootstrap_javascript %}
  {% endblock %}

